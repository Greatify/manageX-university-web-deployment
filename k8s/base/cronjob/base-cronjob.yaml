apiVersion: batch/v1
kind: CronJob
metadata:
  name: university-cronjob
  labels:
    app: university-cronjob
spec:
  schedule: "*/1 * * * *"
  concurrencyPolicy: "Replace"
  successfulJobsHistoryLimit: 1
  failedJobsHistoryLimit: 1
  jobTemplate:
    spec:
      template:
        metadata:
          labels:
            app: university-cronjob
        spec:
          serviceAccountName: university-service
          volumes:
            - name: university-secrets
              csi:
                driver: secrets-store.csi.k8s.io
                readOnly: true
                volumeAttributes:
                  secretProviderClass: managex-university-secrets
          containers:
            - name: university-cronjob
              image: 399600302704.dkr.ecr.ap-south-1.amazonaws.com/managex_university:stage-c4a5e79719efb58134ad4bd8015db81644b6ae56-MNX-1500-PR1271
              command: ["php", "/var/www/html/artisan", "schedule:run"]
              volumeMounts:
                - name: university-secrets
                  mountPath: "/var/www/html/.env"
                  subPath: ".env"
                  readOnly: true
          restartPolicy: OnFailure
